<!DOCTYPE html>
<html>
<head>
    <title>TeleDrive Files</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .file-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .file-card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; transition: transform 0.2s; }
        .file-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .file-icon { font-size: 48px; margin-bottom: 10px; text-align: center; }
        .file-name { font-weight: bold; margin-bottom: 5px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .file-meta { color: #666; font-size: 14px; }
        .file-actions { margin-top: 15px; display: flex; justify-content: space-between; }
        button { cursor: pointer; padding: 8px 12px; border: none; border-radius: 4px; }
        .primary-btn { background: #4285F4; color: white; }
        .info-panel { background: #f5f5f5; border-radius: 8px; padding: 15px; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>TeleDrive Files</h1>
            <button class="primary-btn" id="refresh-btn" onclick="loadFiles()">Refresh</button>
        </div>

        <div id="loading">Loading files...</div>
        <div id="file-list" class="file-grid"></div>
        <div id="no-files" style="display:none;">No files found. Send files to your Telegram bot to get started.</div>

        <div class="info-panel">
            <h3>File Size Limits</h3>
            <p>Telegram Bot API limits file downloads to <strong>20MB</strong>.</p>
            <p>Larger files will show an error: "Bad Request: file is too big"</p>
        </div>
    </div>

    <script>
        // Load files when page loads
        document.addEventListener('DOMContentLoaded', loadFiles);

        async function loadFiles() {
            const loading = document.getElementById('loading');
            const fileList = document.getElementById('file-list');
            const noFiles = document.getElementById('no-files');
            
            loading.style.display = 'block';
            fileList.innerHTML = '';
            noFiles.style.display = 'none';
            
            try {
                // Try to load files directly from files.json in data directory
                const response = await fetch('/data/files.json');
                
                if (!response.ok) {
                    throw new Error(`Error: ${response.status} ${response.statusText}`);
                }
                
                const files = await response.json();
                
                if (files && files.length > 0) {
                    // Sort by newest first
                    files.sort((a, b) => new Date(b.uploadDate) - new Date(a.uploadDate));
                    
                    files.forEach(file => {
                        const fileCard = createFileCard(file);
                        fileList.appendChild(fileCard);
                    });
                } else {
                    noFiles.style.display = 'block';
                }
            } catch (error) {
                console.error('Error loading files:', error);
                fileList.innerHTML = `<p style="color:red">Error loading files: ${error.message}</p>`;
            } finally {
                loading.style.display = 'none';
            }
        }
        
        function createFileCard(file) {
            const card = document.createElement('div');
            card.className = 'file-card';
            
            // Choose icon based on file type
            let iconHtml = '<div class="file-icon">üìÑ</div>';
            if (file.fileType === 'photo') {
                iconHtml = `<img src="${file.filePath}" alt="${file.fileName}" style="max-width:100%; max-height:150px; object-fit:contain; display:block; margin:0 auto;" onerror="this.onerror=null;this.src='';this.parentElement.innerHTML='<div class=\\'file-icon\\'>üñºÔ∏è</div>'">`;
            } else if (file.fileType === 'video') {
                iconHtml = '<div class="file-icon">üé¨</div>';
            } else if (file.fileType === 'audio') {
                iconHtml = '<div class="file-icon">üéµ</div>';
            }
            
            card.innerHTML = `
                ${iconHtml}
                <div class="file-name" title="${file.originalFileName || file.fileName}">${file.originalFileName || file.fileName}</div>
                <div class="file-meta">
                    ${file.fileSize ? (file.fileSize / 1024 / 1024).toFixed(2) + ' MB' : 'Unknown size'}<br>
                    ${new Date(file.uploadDate).toLocaleString()}
                </div>
                <div class="file-actions">
                    <a href="${file.filePath}" download="${file.originalFileName || file.fileName}">
                        <button class="primary-btn">Download</button>
                    </a>
                </div>
            `;
            
            return card;
        }
    </script>
</body>
</html> 