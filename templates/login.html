{% extends 'base.html' %}

{% block title %}Đăng nhập - TeleDrive{% endblock %}

{% block extra_css %}
<style>
    .telegram-widget {
        text-align: center;
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <div class="auth-logo">
            <i class="fas fa-cloud"></i>
            <h1>TeleDrive</h1>
        </div>
        <h2>Đăng nhập</h2>
        
        <div class="telegram-login">
            <div class="telegram-widget" id="telegram-login">
                <!-- Telegram Widget sẽ được render tại đây -->
            </div>
            <div class="separator">hoặc</div>
        </div>
        
        <form method="POST" action="{{ url_for('login') }}">
            <div class="form-group">
                <input type="text" id="username" name="username" class="form-control" placeholder="Tên người dùng" required>
            </div>
            
            <div class="form-group">
                <input type="password" id="password" name="password" class="form-control" placeholder="Mật khẩu" required>
            </div>
            
            <div class="form-group">
                <button type="submit" class="btn btn-primary btn-block">Đăng nhập</button>
            </div>
        </form>
        
        <div class="auth-links">
            <p>Chưa có tài khoản? <a href="{{ url_for('register') }}">Đăng ký ngay</a></p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script async src="https://telegram.org/js/telegram-widget.js?22"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        window.TelegramLoginWidget = {
            dataOnauth: function(user) {
                // Gửi dữ liệu người dùng đến route xử lý đăng nhập Telegram
                var form = document.createElement('form');
                form.method = 'POST';
                form.action = '{{ url_for("telegram_auth") }}';
                
                for (var key in user) {
                    if (user.hasOwnProperty(key)) {
                        var input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = key;
                        input.value = user[key];
                        form.appendChild(input);
                    }
                }
                
                document.body.appendChild(form);
                form.submit();
            }
        };
        
        // Render widget Telegram Login
        var script = document.createElement('script');
        script.src = 'https://telegram.org/js/telegram-widget.js?22';
        script.setAttribute('data-telegram-login', '{{ bot_username }}');
        script.setAttribute('data-size', 'large');
        script.setAttribute('data-radius', '4');
        script.setAttribute('data-auth-url', '{{ url_for("telegram_auth", _external=True) }}');
        script.setAttribute('data-request-access', 'write');
        document.getElementById('telegram-login').appendChild(script);
    });
</script>
{% endblock %} 