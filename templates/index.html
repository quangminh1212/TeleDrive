<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="TeleDrive - Qu·∫£n l√Ω file t·ª´ Telegram m·ªôt c√°ch d·ªÖ d√†ng v√† hi·ªáu qu·∫£">
    <meta name="keywords" content="telegram, file manager, cloud storage, file sharing">
    <meta name="author" content="TeleDrive Team">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:title" content="TeleDrive File Manager">
    <meta property="og:description" content="Qu·∫£n l√Ω file t·ª´ Telegram m·ªôt c√°ch d·ªÖ d√†ng v√† hi·ªáu qu·∫£">
    <!-- <meta property="og:image" content="{{ url_for('static', filename='images/logo.png') }}"> -->

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{ request.url }}">
    <meta property="twitter:title" content="TeleDrive File Manager">
    <meta property="twitter:description" content="Qu·∫£n l√Ω file t·ª´ Telegram m·ªôt c√°ch d·ªÖ d√†ng v√† hi·ªáu qu·∫£">
    <!-- <meta property="twitter:image" content="{{ url_for('static', filename='images/logo.png') }}"> -->

    <title>TeleDrive File Manager</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Product+Sans:wght@400;500;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css?v=1753289572">
    <link rel="stylesheet" href="/static/css/mobile.css?v=1753289572">
    <link rel="stylesheet" href="/static/css/gdrive.css?v=1753289572">

    <style>
        /* ƒê·∫£m b·∫£o font hi·ªÉn th·ªã ƒë√∫ng */
        body {
            font-family: 'Roboto', 'Google Sans', 'Product Sans', sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .gdrive-file-name, 
        .gdrive-breadcrumb-item,
        .gdrive-btn-primary,
        .gdrive-sidebar-item {
            font-family: 'Google Sans', 'Product Sans', 'Roboto', sans-serif;
        }

        /* S·ª≠a l·ªói hi·ªÉn th·ªã ti·∫øng Vi·ªát */
        .gdrive-toolbar-right .gdrive-search-box .gdrive-search-input::placeholder,
        .gdrive-breadcrumb-item span,
        .gdrive-sidebar-item span,
        .gdrive-bulk-toolbar .selection-count {
            font-family: 'Google Sans', 'Product Sans', 'Roboto', sans-serif;
        }
        
        /* Modern scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f3f4;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #dadce0;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #bdc1c6;
        }
        
        /* ·∫®n thanh ti√™u ƒë·ªÅ explorer c≈© */
        .explorer-title-bar {
            display: none;
        }
    </style>
</head>
<body>
    <!-- C·∫•u tr√∫c theo Google Drive UI -->
    <div class="gdrive-layout">
        <!-- Header m·ªõi -->
        <div class="gdrive-header">
            <div class="gdrive-logo">
                <span class="app-icon-text">üìÅ</span>
                <span class="gdrive-logo-text">TeleDrive</span>
            </div>
            
            <div class="gdrive-search-box">
                <i class="icon icon-search"></i>
                <input type="text" class="gdrive-search-input" placeholder="T√¨m ki·∫øm trong TeleDrive" id="globalSearch">
            </div>
            
            <div class="user-menu">
                {% if user %}
                    <div class="user-info">
                        <i class="icon icon-user"></i>
                        {% if user.is_admin %}
                            <div class="admin-menu-container">
                                <button class="admin-badge-btn" id="adminMenuToggle" title="C√†i ƒë·∫∑t Admin">
                                    <span class="admin-badge">Admin</span>
                                    <i class="icon icon-chevron-down"></i>
                                </button>
                                <div class="admin-dropdown-menu" id="adminDropdownMenu">
                                    <div class="admin-menu-header">
                                        <i class="icon icon-settings"></i>
                                        <span>Qu·∫£n l√Ω h·ªá th·ªëng</span>
                                    </div>
                                    <div class="admin-menu-divider"></div>
                                    <button class="admin-menu-item" id="systemManagementBtn">
                                        <i class="icon icon-server"></i>
                                        <span>Qu·∫£n l√Ω h·ªá th·ªëng</span>
                                    </button>
                                    <button class="admin-menu-item" id="userManagementBtn">
                                        <i class="icon icon-user"></i>
                                        <span>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</span>
                                    </button>
                                    <button class="admin-menu-item" id="systemSettingsBtn">
                                        <i class="icon icon-settings"></i>
                                        <span>C√†i ƒë·∫∑t h·ªá th·ªëng</span>
                                    </button>
                                    <button class="admin-menu-item" id="scanSettingsBtn">
                                        <i class="icon icon-scan"></i>
                                        <span>C√†i ƒë·∫∑t Telegram</span>
                                    </button>
                                    <button class="admin-menu-item" id="logsViewBtn">
                                        <i class="icon icon-file-text"></i>
                                        <span>Xem logs</span>
                                    </button>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                {% else %}
                    <a href="/login" class="login-link">ƒêƒÉng nh·∫≠p</a>
                {% endif %}
            </div>
        </div>
        
        <!-- Main content area -->
        <div class="gdrive-content">
            <!-- Sidebar -->
            <div class="gdrive-sidebar">
                <div class="gdrive-sidebar-item active">
                    <i class="icon icon-home"></i>
                    <span>TeleDrive Home</span>
                </div>
                <div class="gdrive-sidebar-item">
                    <i class="icon icon-clock"></i>
                    <span>Recent files</span>
                </div>
                <div class="gdrive-sidebar-item">
                    <i class="icon icon-share"></i>
                    <span>Shared with me</span>
                </div>
                <div class="gdrive-sidebar-item">
                    <i class="icon icon-star"></i>
                    <span>Favorites</span>
                </div>
                
                <div class="gdrive-sidebar-divider"></div>
                <div class="gdrive-sidebar-section">My Scans</div>
                
                <div class="gdrive-sidebar-item">
                    <i class="icon icon-folder"></i>
                    <span>All scans</span>
                </div>
                <div class="gdrive-sidebar-item">
                    <i class="icon icon-file"></i>
                    <span>Documents</span>
                </div>
                <div class="gdrive-sidebar-item">
                    <i class="icon icon-image"></i>
                    <span>Images</span>
                </div>
                <div class="gdrive-sidebar-item">
                    <i class="icon icon-video"></i>
                    <span>Videos</span>
                </div>
                <div class="gdrive-sidebar-item">
                    <i class="icon icon-archive"></i>
                    <span>Archives</span>
                </div>
                
                <div class="gdrive-sidebar-divider"></div>
                <div class="gdrive-sidebar-section">Telegram Sessions</div>
                
                <div class="gdrive-sidebar-storage">
                    <div class="storage-usage-bar">
                        <div class="storage-used" style="width: 25%"></div>
                    </div>
                    <div class="storage-text">2.5 GB of 10 GB used</div>
                </div>
                
                <button class="gdrive-btn-primary gdrive-upgrade-btn">
                    <i class="icon icon-upload"></i>
                    <span>Scan Telegram</span>
                </button>
            </div>
            
            <!-- Files container -->
            <div class="gdrive-files-container">
                <!-- Toolbar with breadcrumbs and actions -->
                <div class="gdrive-toolbar">
                    <div class="gdrive-toolbar-left">
                        <div class="gdrive-breadcrumb">
                            <div class="gdrive-breadcrumb-item">
                                <i class="icon icon-drive"></i>
                                <span>TeleDrive</span>
                            </div>
                            <div class="gdrive-breadcrumb-separator">/</div>
                            <div class="gdrive-breadcrumb-item current">
                                <span>Home</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="gdrive-toolbar-right">
                        <div class="gdrive-view-toggle">
                            <button class="gdrive-view-btn active" data-view="grid" title="Grid view">
                                <i class="icon icon-grid"></i>
                            </button>
                            <button class="gdrive-view-btn" data-view="list" title="List view">
                                <i class="icon icon-list"></i>
                            </button>
                        </div>
                        
                        <button class="gdrive-btn-secondary" id="scanButton">
                            <i class="icon icon-scan"></i>
                            <span>Scan</span>
                        </button>
                    </div>
                </div>
                
                <!-- Files display area -->
                <div class="gdrive-files-display gdrive-grid-view" id="filesContainer">
                    <!-- Empty state -->
                    <div class="gdrive-empty">
                        <div class="gdrive-empty-icon">üìÅ</div>
                        <div class="gdrive-empty-text">Kh√¥ng t√¨m th·∫•y file n√†o</div>
                        <div class="gdrive-empty-subtext">Th·ª≠ thay ƒë·ªïi t·ª´ kh√≥a t√¨m ki·∫øm ho·∫∑c b·ªô l·ªçc</div>
                        <button class="gdrive-btn-primary" id="startScanBtn" style="margin-top: 16px">
                            <i class="icon icon-scan"></i>
                            <span>B·∫Øt ƒë·∫ßu qu√©t Telegram</span>
                        </button>
                    </div>
                </div>
                
                <!-- Selection toolbar (hidden by default) -->
                <div class="gdrive-bulk-toolbar" style="display: none;">
                    <div class="gdrive-bulk-info">
                        <span class="selection-count">0 items selected</span>
                    </div>
                    <div class="gdrive-bulk-actions">
                        <button class="gdrive-btn-ghost" data-action="download">
                            <i class="icon icon-download"></i>
                            <span>Download</span>
                        </button>
                        <button class="gdrive-btn-ghost" data-action="share">
                            <i class="icon icon-share"></i>
                            <span>Share</span>
                        </button>
                        <button class="gdrive-btn-ghost gdrive-btn-danger" data-action="delete">
                            <i class="icon icon-trash"></i>
                            <span>Delete</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Mobile sidebar toggle button -->
    <button class="gdrive-mobile-sidebar-toggle" id="mobileSidebarToggle" style="display: none;">
        <i class="icon icon-menu"></i>
    </button>

    <!-- Scripts -->
    <script src="/static/js/app.js?v=1753289572"></script>
    <script src="/static/js/explorer.js?v=1753289572"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile sidebar toggle
            const sidebar = document.querySelector('.gdrive-sidebar');
            const sidebarToggle = document.getElementById('mobileSidebarToggle');
            
            if (window.innerWidth <= 768) {
                sidebarToggle.style.display = 'flex';
            }
            
            sidebarToggle?.addEventListener('click', function() {
                sidebar.classList.toggle('open');
            });
            
            // Admin menu toggle
            const adminMenuToggle = document.getElementById('adminMenuToggle');
            const adminDropdownMenu = document.getElementById('adminDropdownMenu');
            
            adminMenuToggle?.addEventListener('click', function(e) {
                adminDropdownMenu.classList.toggle('show');
                e.stopPropagation();
            });
            
            // Close admin menu when clicking elsewhere
            document.addEventListener('click', function() {
                adminDropdownMenu?.classList.remove('show');
            });
            
            // Admin menu actions
            document.getElementById('systemManagementBtn')?.addEventListener('click', function() {
                adminAction('system_management');
            });
            
            document.getElementById('userManagementBtn')?.addEventListener('click', function() {
                adminAction('user_management');
            });
            
            document.getElementById('systemSettingsBtn')?.addEventListener('click', function() {
                adminAction('system_settings');
            });
            
            document.getElementById('scanSettingsBtn')?.addEventListener('click', function() {
                adminAction('scan_settings');
            });
            
            document.getElementById('logsViewBtn')?.addEventListener('click', function() {
                adminAction('logs_view');
            });
            
            document.getElementById('scanButton')?.addEventListener('click', function() {
                startScan();
            });
            
            document.getElementById('startScanBtn')?.addEventListener('click', function() {
                startScan();
            });
            
            // Admin action handler
            function adminAction(action) {
                fetch('/api/admin/menu-action', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ action: action })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.redirect) {
                        window.location.href = data.redirect;
                    }
                })
                .catch(error => console.error('Error:', error));
            }
            
            // Start scan function
            function startScan() {
                // Show loading indicator
                const filesContainer = document.getElementById('filesContainer');
                filesContainer.innerHTML = '<div class="gdrive-loading"><div class="gdrive-loading-spinner"></div><div class="gdrive-loading-text">ƒêang qu√©t Telegram...</div></div>';
                
                fetch('/api/scan/telegram', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        scan_type: 'telegram',
                        options: {
                            max_messages: 1000,
                            file_types: ['documents', 'photos', 'videos', 'audio']
                        }
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Show success message
                        alert('ƒê√£ b·∫Øt ƒë·∫ßu qu√©t Telegram th√†nh c√¥ng! Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t.');
                    } else {
                        // Show error message
                        alert('L·ªói khi b·∫Øt ƒë·∫ßu qu√©t: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('ƒê√£ x·∫£y ra l·ªói khi b·∫Øt ƒë·∫ßu qu√©t. Vui l√≤ng th·ª≠ l·∫°i sau.');
                });
            }
        });
    </script>
</body>
</html>
