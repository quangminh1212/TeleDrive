{% extends "base.html" %}

{% block title %}Scan Telegram Channels - TeleDrive{% endblock %}

{% block content %}
<div class="content-header">
    <div class="content-title">
        <h1>Scan Telegram Channels</h1>
        <p class="content-subtitle">Discover and import files from Telegram channels</p>
    </div>
</div>

<!-- Scan Form -->
<div class="scan-container">
    <div class="scan-card">
        <div class="scan-header">
            <div class="scan-icon">
                <i class="fab fa-telegram"></i>
            </div>
            <h2>Channel Scanner</h2>
            <p>Enter a Telegram channel URL or username to scan for files</p>
        </div>
        
        <form class="scan-form" id="scanForm">
            <div class="form-group">
                <label for="channelInput">Channel URL or Username</label>
                <div class="input-group">
                    <input type="text" 
                           id="channelInput" 
                           name="channel" 
                           placeholder="@channelname or https://t.me/channelname"
                           required>
                    <button type="button" class="input-btn" id="pasteBtn" title="Paste from clipboard">
                        <i class="fas fa-paste"></i>
                    </button>
                </div>
                <div class="form-help">
                    <p>Supported formats:</p>
                    <ul>
                        <li><code>@channelname</code> - Public channel username</li>
                        <li><code>https://t.me/channelname</code> - Public channel link</li>
                        <li><code>https://t.me/joinchat/xxxxx</code> - Private channel invite (old format)</li>
                        <li><code>https://t.me/+xxxxx</code> - Private channel invite (new format)</li>
                    </ul>
                </div>
            </div>
            
            <div class="form-group">
                <label>File Types to Scan</label>
                <div class="checkbox-grid">
                    <label class="checkbox-item">
                        <input type="checkbox" name="scan_documents" checked>
                        <span class="checkmark"></span>
                        <i class="fas fa-file-alt"></i>
                        Documents
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="scan_photos" checked>
                        <span class="checkmark"></span>
                        <i class="fas fa-image"></i>
                        Photos
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="scan_videos" checked>
                        <span class="checkmark"></span>
                        <i class="fas fa-video"></i>
                        Videos
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="scan_audio" checked>
                        <span class="checkmark"></span>
                        <i class="fas fa-music"></i>
                        Audio
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="scan_voice">
                        <span class="checkmark"></span>
                        <i class="fas fa-microphone"></i>
                        Voice Messages
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="scan_stickers">
                        <span class="checkmark"></span>
                        <i class="fas fa-smile"></i>
                        Stickers
                    </label>
                </div>
            </div>
            
            <div class="form-group">
                <label for="maxMessages">Maximum Messages to Scan</label>
                <select id="maxMessages" name="max_messages">
                    <option value="">All messages (unlimited)</option>
                    <option value="100">Last 100 messages</option>
                    <option value="500">Last 500 messages</option>
                    <option value="1000" selected>Last 1,000 messages</option>
                    <option value="5000">Last 5,000 messages</option>
                    <option value="10000">Last 10,000 messages</option>
                </select>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-large" id="startScanBtn">
                    <i class="fas fa-search"></i>
                    Start Scanning
                </button>
                <button type="button" class="btn btn-secondary" id="testConnectionBtn">
                    <i class="fas fa-plug"></i>
                    Test Connection
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Scan Progress -->
<div class="scan-progress-container" id="scanProgressContainer" style="display: none;">
    <div class="scan-progress-card">
        <div class="progress-header">
            <h3>Scanning in Progress</h3>
            <button class="btn btn-secondary btn-small" id="cancelScanBtn">
                <i class="fas fa-stop"></i>
                Cancel
            </button>
        </div>
        
        <div class="progress-info">
            <div class="progress-stats">
                <div class="stat-item">
                    <span class="stat-label">Channel:</span>
                    <span class="stat-value" id="currentChannel">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Messages Scanned:</span>
                    <span class="stat-value" id="messagesScanned">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Files Found:</span>
                    <span class="stat-value" id="filesFound">0</span>
                </div>
            </div>
        </div>
        
        <div class="progress-bar-container">
            <div class="progress-bar">
                <div class="progress-fill" id="scanProgressFill"></div>
            </div>
            <div class="progress-text" id="scanProgressText">Initializing...</div>
        </div>
        
        <div class="progress-log" id="progressLog">
            <div class="log-item">
                <span class="log-time">00:00:00</span>
                <span class="log-message">Scan initialized</span>
            </div>
        </div>
    </div>
</div>

<!-- Recent Scans -->
<div class="recent-scans">
    <h2 class="section-title">Recent Scans</h2>
    <div class="scans-grid" id="recentScansGrid">
        <!-- Recent scans will be loaded here -->
        <div class="scan-item">
            <div class="scan-info">
                <div class="scan-channel">
                    <i class="fab fa-telegram"></i>
                    <span>@example_channel</span>
                </div>
                <div class="scan-meta">
                    <span class="scan-date">2 hours ago</span>
                    <span class="scan-files">156 files</span>
                </div>
            </div>
            <div class="scan-actions">
                <button class="scan-action-btn" title="View Files">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="scan-action-btn" title="Re-scan">
                    <i class="fas fa-redo"></i>
                </button>
                <button class="scan-action-btn" title="Delete">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        
        <div class="scan-item">
            <div class="scan-info">
                <div class="scan-channel">
                    <i class="fab fa-telegram"></i>
                    <span>Private Channel</span>
                </div>
                <div class="scan-meta">
                    <span class="scan-date">1 day ago</span>
                    <span class="scan-files">89 files</span>
                </div>
            </div>
            <div class="scan-actions">
                <button class="scan-action-btn" title="View Files">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="scan-action-btn" title="Re-scan">
                    <i class="fas fa-redo"></i>
                </button>
                <button class="scan-action-btn" title="Delete">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Configuration Status -->
<div class="config-status" id="configStatus">
    <div class="status-card">
        <div class="status-header">
            <i class="fas fa-cog"></i>
            <h3>Configuration Status</h3>
        </div>
        <div class="status-items">
            <div class="status-item" id="telegramStatus">
                <i class="fas fa-circle status-indicator"></i>
                <span>Telegram API</span>
                <span class="status-text">Checking...</span>
            </div>
            <div class="status-item" id="phoneStatus">
                <i class="fas fa-circle status-indicator"></i>
                <span>Phone Number</span>
                <span class="status-text">Checking...</span>
            </div>
            <div class="status-item" id="sessionStatus">
                <i class="fas fa-circle status-indicator"></i>
                <span>Session</span>
                <span class="status-text">Checking...</span>
            </div>
        </div>
        <div class="status-actions">
            <button class="btn btn-secondary btn-small" onclick="window.location.href='/settings'">
                <i class="fas fa-cog"></i>
                Configure
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.content-subtitle {
    font-size: 16px;
    color: #5f6368;
    margin-top: 8px;
}

.scan-container {
    max-width: 800px;
    margin: 0 auto 32px;
}

.scan-card {
    background: #fff;
    border-radius: 8px;
    border: 1px solid #e8eaed;
    padding: 32px;
}

.scan-header {
    text-align: center;
    margin-bottom: 32px;
}

.scan-icon {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    background: #e8f0fe;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 16px;
    font-size: 24px;
    color: #1a73e8;
}

.scan-header h2 {
    font-size: 24px;
    font-weight: 400;
    color: #202124;
    margin-bottom: 8px;
}

.scan-header p {
    font-size: 16px;
    color: #5f6368;
}

.form-group {
    margin-bottom: 24px;
}

.form-group label {
    display: block;
    font-size: 14px;
    font-weight: 500;
    color: #202124;
    margin-bottom: 8px;
}

.input-group {
    position: relative;
    display: flex;
}

.input-group input {
    flex: 1;
    padding: 12px 16px;
    border: 1px solid #dadce0;
    border-radius: 8px;
    font-size: 16px;
    color: #202124;
    background: #fff;
}

.input-group input:focus {
    outline: none;
    border-color: #1a73e8;
    box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
}

.input-btn {
    background: none;
    border: 1px solid #dadce0;
    border-left: none;
    border-radius: 0 8px 8px 0;
    padding: 12px;
    cursor: pointer;
    color: #5f6368;
    transition: all 0.2s;
}

.input-btn:hover {
    background: #f1f3f4;
}

.form-help {
    margin-top: 8px;
    font-size: 12px;
    color: #5f6368;
}

.form-help ul {
    margin: 8px 0 0 16px;
}

.form-help code {
    background: #f1f3f4;
    padding: 2px 4px;
    border-radius: 4px;
    font-family: monospace;
}

.checkbox-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
}

.checkbox-item {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    padding: 12px;
    border: 1px solid #e8eaed;
    border-radius: 8px;
    transition: all 0.2s;
}

.checkbox-item:hover {
    background: #f8f9fa;
    border-color: #dadce0;
}

.checkbox-item input[type="checkbox"] {
    display: none;
}

.checkmark {
    width: 20px;
    height: 20px;
    border: 2px solid #dadce0;
    border-radius: 4px;
    position: relative;
    transition: all 0.2s;
}

.checkbox-item input[type="checkbox"]:checked + .checkmark {
    background: #1a73e8;
    border-color: #1a73e8;
}

.checkbox-item input[type="checkbox"]:checked + .checkmark::after {
    content: '✓';
    position: absolute;
    top: -2px;
    left: 3px;
    color: white;
    font-size: 14px;
    font-weight: bold;
}

.checkbox-item i {
    color: #5f6368;
    width: 20px;
    text-align: center;
}

.form-actions {
    display: flex;
    gap: 16px;
    justify-content: center;
    margin-top: 32px;
}

.btn-large {
    padding: 12px 24px;
    font-size: 16px;
}

.btn-small {
    padding: 6px 12px;
    font-size: 12px;
}

.scan-progress-container {
    max-width: 800px;
    margin: 0 auto 32px;
}

.scan-progress-card {
    background: #fff;
    border-radius: 8px;
    border: 1px solid #e8eaed;
    padding: 24px;
}

.progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.progress-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
}

.stat-item {
    display: flex;
    justify-content: space-between;
    padding: 12px;
    background: #f8f9fa;
    border-radius: 8px;
}

.stat-label {
    font-weight: 500;
    color: #5f6368;
}

.stat-value {
    font-weight: 600;
    color: #202124;
}

.progress-bar-container {
    margin-bottom: 24px;
}

.progress-log {
    max-height: 200px;
    overflow-y: auto;
    background: #f8f9fa;
    border-radius: 8px;
    padding: 16px;
}

.log-item {
    display: flex;
    gap: 12px;
    margin-bottom: 8px;
    font-size: 12px;
}

.log-time {
    color: #5f6368;
    font-family: monospace;
}

.log-message {
    color: #202124;
}

.recent-scans {
    margin-bottom: 32px;
}

.scans-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 16px;
}

.scan-item {
    background: #fff;
    border: 1px solid #e8eaed;
    border-radius: 8px;
    padding: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.2s;
}

.scan-item:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.scan-channel {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
    color: #202124;
    margin-bottom: 4px;
}

.scan-channel i {
    color: #0088cc;
}

.scan-meta {
    display: flex;
    gap: 16px;
    font-size: 12px;
    color: #5f6368;
}

.scan-actions {
    display: flex;
    gap: 4px;
}

.scan-action-btn {
    background: none;
    border: none;
    padding: 8px;
    border-radius: 50%;
    cursor: pointer;
    color: #5f6368;
    transition: all 0.2s;
}

.scan-action-btn:hover {
    background: #f1f3f4;
}

.config-status {
    max-width: 400px;
    margin: 0 auto;
}

.status-card {
    background: #fff;
    border: 1px solid #e8eaed;
    border-radius: 8px;
    padding: 24px;
}

.status-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
}

.status-header i {
    color: #5f6368;
}

.status-header h3 {
    font-size: 16px;
    font-weight: 500;
    color: #202124;
    margin: 0;
}

.status-items {
    margin-bottom: 16px;
}

.status-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 0;
}

.status-indicator {
    font-size: 8px;
    color: #dadce0;
}

.status-indicator.success {
    color: #34a853;
}

.status-indicator.error {
    color: #ea4335;
}

.status-indicator.warning {
    color: #fbbc04;
}

.status-text {
    margin-left: auto;
    font-size: 12px;
    color: #5f6368;
}

.status-actions {
    text-align: center;
}
</style>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/scan.js') }}"></script>
{% endblock %}
