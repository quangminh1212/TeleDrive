<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeleDrive File Manager - Clean Version</title>
    <link rel="stylesheet" href="/static/css/gdrive-style.css">
    <link rel="stylesheet" href="/static/css/mobile-responsive.css">
    <style>
        .sessions-list {
            margin-top: 10px;
        }
        .session-item {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .session-item:hover {
            background-color: #f1f3f4;
        }
        .session-item.active {
            background-color: #e8f0fe;
            color: #1a73e8;
        }
        .session-name {
            font-weight: 500;
        }
        .session-count {
            font-size: 12px;
            color: #5f6368;
        }
        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            padding: 20px;
        }
        .file-item {
            border: 1px solid #dadce0;
            border-radius: 8px;
            padding: 16px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        .file-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-color: #1a73e8;
        }
        .file-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        .file-name {
            font-weight: 500;
            margin-bottom: 4px;
            word-break: break-word;
        }
        .file-size {
            font-size: 12px;
            color: #5f6368;
        }
    </style>
</head>
<body>
    <div class="gdrive-layout" id="gdriveLayout">
        <!-- Header -->
        <div class="gdrive-header">
            <div class="gdrive-header-left">
                <span class="gdrive-logo">üìÅ</span>
                <h1>TeleDrive - File Manager</h1>
            </div>
            <div class="gdrive-header-right">
                <button class="gdrive-btn" onclick="logout()">‚á• ƒêƒÉng xu·∫•t</button>
            </div>
        </div>

        <!-- Toolbar -->
        <div class="gdrive-toolbar" id="gdriveToolbar">
            <div class="gdrive-toolbar-left">
                <button class="gdrive-btn">Home</button>
                <button class="gdrive-btn">Share</button>
                <button class="gdrive-btn">View</button>
            </div>
            <div class="gdrive-toolbar-right">
                <div class="gdrive-toolbar-section">
                    <span>Clipboard</span>
                    <button class="gdrive-btn" disabled>Paste</button>
                    <button class="gdrive-btn" disabled>‚óà Cut</button>
                    <button class="gdrive-btn" disabled>‚ñ¢ Copy</button>
                </div>
                <div class="gdrive-toolbar-section">
                    <span>Organize</span>
                    <button class="gdrive-btn" disabled>Move to</button>
                    <button class="gdrive-btn" disabled>Copy to</button>
                    <button class="gdrive-btn" disabled>Delete</button>
                    <button class="gdrive-btn" disabled>‚óê Rename</button>
                </div>
                <div class="gdrive-toolbar-section">
                    <span>New</span>
                    <button class="gdrive-btn">New folder</button>
                </div>
                <div class="gdrive-toolbar-section">
                    <span>Open</span>
                    <button class="gdrive-btn" disabled>‚óØ Properties</button>
                </div>
            </div>
        </div>

        <!-- Breadcrumb -->
        <div class="gdrive-breadcrumb" id="gdriveBreadcrumb">
            <div class="gdrive-breadcrumb-left">
                <button class="gdrive-btn" disabled>‚Üê</button>
                <button class="gdrive-btn" disabled>‚Üí</button>
                <button class="gdrive-btn">‚Üë</button>
            </div>
            <div class="gdrive-breadcrumb-center">
                <div class="gdrive-breadcrumb-path">
                    <button class="gdrive-btn">TeleDrive</button>
                    <span>‚ñ∏</span>
                    <button class="gdrive-btn">Home</button>
                </div>
                <button class="gdrive-btn">‚ñæ</button>
            </div>
            <div class="gdrive-breadcrumb-right">
                <input type="text" placeholder="Search files and folders" class="gdrive-search-input">
                <span>√ó</span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="gdrive-content">
            <!-- Sidebar -->
            <div class="gdrive-sidebar" id="gdriveSidebar">
                <div class="gdrive-sidebar-section">
                    <div class="gdrive-sidebar-header">
                        <button>‚ñæ</button>
                        <span>Quick access</span>
                    </div>
                    <div class="gdrive-sidebar-items">
                        <div class="gdrive-sidebar-item">TeleDrive Home</div>
                        <div class="gdrive-sidebar-item">üîÑ Recent files</div>
                        <div class="gdrive-sidebar-item">Shared with me</div>
                        <div class="gdrive-sidebar-item">Favorites</div>
                    </div>
                </div>

                <div class="gdrive-sidebar-section">
                    <div class="gdrive-sidebar-header">
                        <button>‚ñæ</button>
                        <span>My Scans</span>
                    </div>
                    <div class="gdrive-sidebar-items">
                        <div class="gdrive-sidebar-item">All scans</div>
                        <div class="gdrive-sidebar-item">Documents</div>
                        <div class="gdrive-sidebar-item">Images</div>
                        <div class="gdrive-sidebar-item">Videos</div>
                        <div class="gdrive-sidebar-item">Archives</div>
                    </div>
                </div>

                <div class="gdrive-sidebar-section">
                    <div class="gdrive-sidebar-header">
                        <button>‚ñæ</button>
                        <span>Telegram Sessions</span>
                    </div>
                    <div class="sessions-list" id="sessionsList">
                        <div>‚óã Loading sessions...</div>
                    </div>
                </div>

                <div class="gdrive-sidebar-section">
                    <div class="gdrive-sidebar-header">
                        <button>‚ñ∏</button>
                        <span>Storage</span>
                    </div>
                </div>
            </div>

            <!-- Files Display -->
            <div class="gdrive-files-display" id="gdriveFilesDisplay">
                <div id="welcomeMessage">
                    <h2>Welcome to TeleDrive</h2>
                    <p>Your cloud storage for Telegram files. Select a session from the sidebar to browse your scanned files.</p>
                    <div>
                        <button class="gdrive-btn">üîç B·∫Øt ƒë·∫ßu scan m·ªõi</button>
                        <button class="gdrive-btn">Qu·∫£n l√Ω sessions</button>
                    </div>
                </div>
                <div class="files-grid" id="filesGrid" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        console.log('üéØ TeleDrive Clean Version Loading...');
        
        // Global variables
        let currentSessions = [];
        let currentFiles = [];
        
        // Load sessions
        function loadSessions() {
            console.log('üì° Loading sessions...');
            
            fetch('/api/sessions')
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('HTTP error! status: ' + response.status);
                    }
                    return response.json();
                })
                .then(function(sessions) {
                    console.log('‚úÖ Sessions loaded:', sessions);
                    currentSessions = sessions;
                    displaySessions(sessions);
                })
                .catch(function(error) {
                    console.error('‚ùå Error loading sessions:', error);
                    document.getElementById('sessionsList').innerHTML = '<div style="color: red;">Error loading sessions</div>';
                });
        }
        
        // Display sessions
        function displaySessions(sessions) {
            const sessionsList = document.getElementById('sessionsList');
            
            if (!sessions || sessions.length === 0) {
                sessionsList.innerHTML = '<div>No sessions available</div>';
                return;
            }
            
            let html = '';
            sessions.forEach(function(session) {
                html += '<div class="session-item" onclick="loadSession(\'' + session.id + '\')">';
                html += '<div class="session-name">' + session.name + '</div>';
                html += '<div class="session-count">' + session.file_count + ' files</div>';
                html += '</div>';
            });
            
            sessionsList.innerHTML = html;
        }
        
        // Load session files
        function loadSession(sessionId) {
            console.log('üì° Loading session:', sessionId);
            
            // Update active session
            const sessionItems = document.querySelectorAll('.session-item');
            sessionItems.forEach(function(item) {
                item.classList.remove('active');
            });
            event.target.closest('.session-item').classList.add('active');
            
            // Load files
            fetch('/api/files/' + sessionId)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('HTTP error! status: ' + response.status);
                    }
                    return response.json();
                })
                .then(function(files) {
                    console.log('‚úÖ Files loaded:', files);
                    currentFiles = files;
                    displayFiles(files);
                })
                .catch(function(error) {
                    console.error('‚ùå Error loading files:', error);
                    document.getElementById('filesGrid').innerHTML = '<div style="color: red;">Error loading files</div>';
                });
        }
        
        // Display files
        function displayFiles(files) {
            const welcomeMessage = document.getElementById('welcomeMessage');
            const filesGrid = document.getElementById('filesGrid');
            
            welcomeMessage.style.display = 'none';
            filesGrid.style.display = 'grid';
            
            if (!files || files.length === 0) {
                filesGrid.innerHTML = '<div>No files found</div>';
                return;
            }
            
            let html = '';
            files.forEach(function(file) {
                const icon = getFileIcon(file.file_type);
                const size = formatFileSize(file.file_size);
                
                html += '<div class="file-item">';
                html += '<div class="file-icon">' + icon + '</div>';
                html += '<div class="file-name">' + file.file_name + '</div>';
                html += '<div class="file-size">' + size + '</div>';
                html += '</div>';
            });
            
            filesGrid.innerHTML = html;
        }
        
        // Get file icon
        function getFileIcon(fileType) {
            const icons = {
                'document': 'üìÑ',
                'photo': 'üñºÔ∏è',
                'video': 'üé•',
                'audio': 'üéµ',
                'archive': 'üì¶'
            };
            return icons[fileType] || 'üìÑ';
        }
        
        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Logout function
        function logout() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?')) {
                window.location.href = '/logout';
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ TeleDrive Clean Version Initialized');
            loadSessions();
        });
    </script>
</body>
</html>
