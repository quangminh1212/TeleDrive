<!-- TeleDrive Upload Zone Component - Enhanced Google Drive Style -->
<div class="gdrive-upload-zone" id="uploadZone">
    <div class="gdrive-upload-content">
        <div class="gdrive-upload-icon">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor">
                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                <path d="M12,11L16,15H13V19H11V15H8L12,11Z" fill="#4285f4"/>
            </svg>
        </div>
        <div class="gdrive-upload-text">
            Kéo thả files vào đây để tải lên
        </div>
        <div class="gdrive-upload-subtext">
            hoặc
        </div>
        <div class="gdrive-upload-actions">
            <button class="gdrive-btn-primary" id="uploadFilesBtn">
                <i class="fas fa-file-upload"></i>
                Chọn từ thiết bị
            </button>
            <button class="gdrive-btn-secondary" id="uploadFolderBtn">
                <i class="fas fa-folder-open"></i>
                Chọn thư mục
            </button>
        </div>
    </div>

    <!-- Upload progress area -->
    <div class="gdrive-upload-progress" id="uploadProgress" style="display: none;">
        <div class="gdrive-upload-progress-header">
            <span>Đang tải lên...</span>
            <button class="gdrive-btn-icon" id="cancelUpload">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="gdrive-upload-progress-list" id="uploadProgressList">
            <!-- Progress items will be added here -->
        </div>
    </div>

    <!-- Input ẩn để chọn files -->
    <input type="file" id="fileInput" style="display: none;" multiple accept="*/*">
    <!-- Input ẩn để chọn thư mục -->
    <input type="file" id="folderInput" style="display: none;" webkitdirectory directory multiple>
</div>

<!-- Upload progress item template -->
<template id="uploadProgressTemplate">
    <div class="gdrive-upload-item">
        <div class="gdrive-upload-item-icon">
            <i class="fas fa-file"></i>
        </div>
        <div class="gdrive-upload-item-info">
            <div class="gdrive-upload-item-name"></div>
            <div class="gdrive-upload-item-progress">
                <div class="gdrive-progress-bar">
                    <div class="gdrive-progress-fill"></div>
                </div>
                <div class="gdrive-upload-item-status"></div>
            </div>
        </div>
        <div class="gdrive-upload-item-actions">
            <button class="gdrive-btn-icon cancel-upload">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>
</template>

<style>
    /* Enhanced Upload Zone - Google Drive Style */
    .gdrive-upload-zone {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 300px;
        padding: 48px 32px;
        border: 2px dashed var(--gdrive-border);
        border-radius: 12px;
        background-color: var(--gdrive-white);
        margin: 24px;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
    }

    .gdrive-upload-zone:hover {
        border-color: var(--gdrive-blue);
        background-color: rgba(66, 133, 244, 0.02);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .gdrive-upload-zone.drag-over {
        border-color: var(--gdrive-blue);
        background-color: rgba(66, 133, 244, 0.08);
        transform: scale(1.02);
        box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.2);
    }

    .gdrive-upload-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        max-width: 400px;
    }

    .gdrive-upload-icon {
        color: var(--gdrive-blue);
        margin-bottom: 24px;
        opacity: 0.8;
    }

    .gdrive-upload-icon svg {
        width: 64px;
        height: 64px;
    }

    .gdrive-upload-text {
        font-size: 20px;
        font-weight: 400;
        color: var(--gdrive-text);
        margin-bottom: 8px;
        line-height: 1.4;
    }

    .gdrive-upload-subtext {
        font-size: 14px;
        color: var(--gdrive-text-secondary);
        margin: 16px 0 24px;
        text-transform: lowercase;
    }

    .gdrive-upload-actions {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
        justify-content: center;
    }

    /* Upload Progress */
    .gdrive-upload-progress {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--gdrive-white);
        border-radius: 12px;
        padding: 24px;
        display: flex;
        flex-direction: column;
    }

    .gdrive-upload-progress-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        font-weight: 500;
        color: var(--gdrive-text);
    }

    .gdrive-upload-progress-list {
        flex: 1;
        overflow-y: auto;
        max-height: 300px;
    }

    .gdrive-upload-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 0;
        border-bottom: 1px solid var(--gdrive-border);
    }

    .gdrive-upload-item:last-child {
        border-bottom: none;
    }

    .gdrive-upload-item-icon {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--gdrive-text-secondary);
        font-size: 16px;
    }

    .gdrive-upload-item-info {
        flex: 1;
        min-width: 0;
    }

    .gdrive-upload-item-name {
        font-size: 14px;
        color: var(--gdrive-text);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: 4px;
    }

    .gdrive-upload-item-progress {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .gdrive-progress-bar {
        flex: 1;
        height: 4px;
        background-color: var(--gdrive-light-gray);
        border-radius: 2px;
        overflow: hidden;
    }

    .gdrive-progress-fill {
        height: 100%;
        background-color: var(--gdrive-blue);
        border-radius: 2px;
        transition: width 0.3s ease;
        width: 0%;
    }

    .gdrive-upload-item-status {
        font-size: 12px;
        color: var(--gdrive-text-secondary);
        white-space: nowrap;
    }

    .gdrive-upload-item-actions {
        display: flex;
        align-items: center;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
        .gdrive-upload-zone {
            margin: 16px;
            padding: 32px 16px;
            min-height: 250px;
        }

        .gdrive-upload-text {
            font-size: 18px;
        }

        .gdrive-upload-actions {
            flex-direction: column;
            width: 100%;
        }

        .gdrive-upload-actions button {
            width: 100%;
            justify-content: center;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Lấy các elements
        const uploadZone = document.getElementById('uploadZone');
        const uploadFilesBtn = document.getElementById('uploadFilesBtn');
        const uploadFolderBtn = document.getElementById('uploadFolderBtn');
        const fileInput = document.getElementById('fileInput');
        const folderInput = document.getElementById('folderInput');
        
        // Kiểm tra xem trình duyệt có hỗ trợ webkitdirectory không
        if (!('webkitdirectory' in fileInput)) {
            uploadFolderBtn.style.display = 'none';
        }
        
        // Khi click vào nút "Chọn files"
        uploadFilesBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            fileInput.click();
        });
        
        // Khi click vào nút "Chọn thư mục"
        uploadFolderBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            folderInput.click();
        });
        
        // Khi click vào vùng upload
        uploadZone.addEventListener('click', function() {
            fileInput.click();
        });
        
        // Khi chọn files
        fileInput.addEventListener('change', function() {
            if (this.files.length) {
                handleSelectedFiles(this.files);
            }
        });
        
        // Khi chọn thư mục
        folderInput.addEventListener('change', function() {
            if (this.files.length) {
                handleSelectedFiles(this.files);
            }
        });
        
        // Xử lý drag & drop (sẽ được xử lý bởi DragDropManager)
        // Nhưng vẫn cần các event handlers cơ bản để hiển thị visual feedback
        uploadZone.addEventListener('dragenter', function(e) {
            e.preventDefault();
            e.stopPropagation();
            this.classList.add('drag-over');
        });
        
        uploadZone.addEventListener('dragover', function(e) {
            e.preventDefault();
            e.stopPropagation();
        });
        
        uploadZone.addEventListener('dragleave', function(e) {
            e.preventDefault();
            e.stopPropagation();
            if (!this.contains(e.relatedTarget)) {
                this.classList.remove('drag-over');
            }
        });
        
        // Hàm xử lý files được chọn
        function handleSelectedFiles(files) {
            // Hiển thị thông báo
            showUploadingNotification(files.length);
            
            // Nếu đã tích hợp với FileOperations
            if (window.fileOperations) {
                // Lấy đường dẫn hiện tại
                const currentPath = getCurrentPath();
                
                // Upload files
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    window.fileOperations.uploadFile(currentPath, file, updateProgress)
                        .then(result => {
                            console.log(`File ${file.name} uploaded successfully`, result);
                        })
                        .catch(error => {
                            console.error(`Failed to upload ${file.name}`, error);
                        });
                }
            } else {
                console.warn('FileOperations module not available');
                // Fallback - giả lập tải lên thành công sau 2 giây
                setTimeout(() => {
                    showUploadSuccessNotification(files.length);
                }, 2000);
            }
            
            // Reset input để có thể chọn cùng file lần nữa nếu cần
            fileInput.value = '';
            folderInput.value = '';
        }
        
        // Lấy đường dẫn hiện tại (sẽ được cập nhật bởi ứng dụng)
        function getCurrentPath() {
            // Mặc định là thư mục gốc
            return window.currentPath || '/';
        }
        
        // Hiển thị thông báo đang tải lên
        function showUploadingNotification(fileCount) {
            // Kiểm tra nếu có notifications container
            let container = document.querySelector('.gdrive-notifications');
            if (!container) {
                container = document.createElement('div');
                container.className = 'gdrive-notifications';
                Object.assign(container.style, {
                    position: 'fixed',
                    bottom: '20px',
                    right: '20px',
                    zIndex: '9999'
                });
                document.body.appendChild(container);
            }
            
            // Tạo thông báo
            const notification = document.createElement('div');
            notification.className = 'gdrive-notification notification-info';
            notification.textContent = `Đang tải lên ${fileCount} tệp tin...`;
            
            // Style thông báo
            Object.assign(notification.style, {
                backgroundColor: '#2196f3',
                color: 'white',
                padding: '12px 16px',
                borderRadius: '4px',
                margin: '8px 0',
                boxShadow: '0 2px 5px rgba(0, 0, 0, 0.2)',
                animation: 'fadeIn 0.3s'
            });
            
            // Thêm vào container
            container.appendChild(notification);
            
            // Xóa sau 5 giây
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
        
        // Hiển thị thông báo tải lên thành công
        function showUploadSuccessNotification(fileCount) {
            let container = document.querySelector('.gdrive-notifications');
            if (!container) {
                container = document.createElement('div');
                container.className = 'gdrive-notifications';
                Object.assign(container.style, {
                    position: 'fixed',
                    bottom: '20px',
                    right: '20px',
                    zIndex: '9999'
                });
                document.body.appendChild(container);
            }
            
            // Tạo thông báo
            const notification = document.createElement('div');
            notification.className = 'gdrive-notification notification-success';
            notification.textContent = `Đã tải lên ${fileCount} tệp tin thành công!`;
            
            // Style thông báo
            Object.assign(notification.style, {
                backgroundColor: '#4caf50',
                color: 'white',
                padding: '12px 16px',
                borderRadius: '4px',
                margin: '8px 0',
                boxShadow: '0 2px 5px rgba(0, 0, 0, 0.2)',
                animation: 'fadeIn 0.3s'
            });
            
            // Thêm vào container
            container.appendChild(notification);
            
            // Xóa sau 5 giây
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
        
        // Cập nhật tiến trình upload
        function updateProgress(percent, event) {
            // Sẽ được cài đặt sau khi tích hợp với progress bar
            console.log(`Upload progress: ${percent.toFixed(1)}%`);
        }
        
        // Style cho animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
        `;
        document.head.appendChild(style);
    });
</script> 