<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√†i ƒë·∫∑t h·ªá th·ªëng - TeleDrive Admin</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .admin-page {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .admin-header {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #007bff;
        }
        .admin-header h1 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 24px;
        }
        .admin-header p {
            margin: 0;
            color: #666;
        }
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
        }
        .settings-section {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .settings-section h3 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        .settings-section .icon {
            font-size: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        .form-group small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 12px;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-right: 10px;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn:hover {
            opacity: 0.9;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            color: #007bff;
            text-decoration: none;
            margin-bottom: 20px;
        }
        .back-link:hover {
            text-decoration: underline;
        }
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #28a745; }
        .status-warning { background: #ffc107; }
        .status-error { background: #dc3545; }
        .current-value {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 13px;
            margin-bottom: 10px;
            border-left: 3px solid #007bff;
        }
    </style>
</head>
<body>
    <div class="admin-page">
        <a href="{{ url_for('index') }}" class="back-link">
            <span>‚Üê</span> Quay l·∫°i Dashboard
        </a>
        
        <div class="admin-header">
            <h1>‚öôÔ∏è C√†i ƒë·∫∑t h·ªá th·ªëng</h1>
            <p>C·∫•u h√¨nh c√°c th√¥ng s·ªë h·ªá th·ªëng TeleDrive</p>
        </div>

        <div class="settings-grid">
            <!-- Application Settings -->
            <div class="settings-section">
                <h3>
                    <span class="icon">üì±</span>
                    C√†i ƒë·∫∑t ·ª©ng d·ª•ng
                </h3>
                <form id="appSettingsForm">
                    <div class="form-group">
                        <label for="appName">T√™n ·ª©ng d·ª•ng:</label>
                        <div class="current-value">Hi·ªán t·∫°i: {{ config.app_name or 'TeleDrive' }}</div>
                        <input type="text" id="appName" name="app_name" value="{{ config.app_name or 'TeleDrive' }}">
                        <small>T√™n hi·ªÉn th·ªã c·ªßa ·ª©ng d·ª•ng</small>
                    </div>
                    <div class="form-group">
                        <label for="appDescription">M√¥ t·∫£:</label>
                        <textarea id="appDescription" name="app_description">{{ config.app_description or 'TeleDrive - Cloud storage for Telegram files' }}</textarea>
                        <small>M√¥ t·∫£ ng·∫Øn v·ªÅ ·ª©ng d·ª•ng</small>
                    </div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="debugMode" name="debug_mode" {{ 'checked' if config.debug else '' }}>
                            <label for="debugMode">Debug Mode</label>
                        </div>
                        <small>B·∫≠t ch·∫ø ƒë·ªô debug (ch·ªâ d√πng cho development)</small>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        üíæ L∆∞u c√†i ƒë·∫∑t ·ª©ng d·ª•ng
                    </button>
                </form>
            </div>

            <!-- Database Settings -->
            <div class="settings-section">
                <h3>
                    <span class="icon">üóÑÔ∏è</span>
                    C√†i ƒë·∫∑t Database
                </h3>
                <form id="dbSettingsForm">
                    <div class="form-group">
                        <label for="dbBackupInterval">T·ª± ƒë·ªông backup (gi·ªù):</label>
                        <div class="current-value">Hi·ªán t·∫°i: {{ config.db_backup_interval or '24' }} gi·ªù</div>
                        <select id="dbBackupInterval" name="db_backup_interval">
                            <option value="6" {{ 'selected' if config.db_backup_interval == '6' else '' }}>6 gi·ªù</option>
                            <option value="12" {{ 'selected' if config.db_backup_interval == '12' else '' }}>12 gi·ªù</option>
                            <option value="24" {{ 'selected' if config.db_backup_interval == '24' else '' }}>24 gi·ªù</option>
                            <option value="72" {{ 'selected' if config.db_backup_interval == '72' else '' }}>3 ng√†y</option>
                            <option value="168" {{ 'selected' if config.db_backup_interval == '168' else '' }}>1 tu·∫ßn</option>
                        </select>
                        <small>Kho·∫£ng th·ªùi gian t·ª± ƒë·ªông backup database</small>
                    </div>
                    <div class="form-group">
                        <label for="maxBackups">S·ªë backup t·ªëi ƒëa:</label>
                        <div class="current-value">Hi·ªán t·∫°i: {{ config.max_backups or '10' }} files</div>
                        <input type="number" id="maxBackups" name="max_backups" value="{{ config.max_backups or '10' }}" min="1" max="100">
                        <small>S·ªë l∆∞·ª£ng file backup t·ªëi ƒëa ƒë∆∞·ª£c gi·ªØ l·∫°i</small>
                    </div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="autoCleanup" name="auto_cleanup" {{ 'checked' if config.auto_cleanup else '' }}>
                            <label for="autoCleanup">T·ª± ƒë·ªông d·ªçn d·∫πp</label>
                        </div>
                        <small>T·ª± ƒë·ªông x√≥a c√°c file backup c≈©</small>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        üíæ L∆∞u c√†i ƒë·∫∑t database
                    </button>
                </form>
            </div>

            <!-- Security Settings -->
            <div class="settings-section">
                <h3>
                    <span class="icon">üîí</span>
                    C√†i ƒë·∫∑t b·∫£o m·∫≠t
                </h3>
                <form id="securitySettingsForm">
                    <div class="form-group">
                        <label for="sessionTimeout">Th·ªùi gian session (ph√∫t):</label>
                        <div class="current-value">Hi·ªán t·∫°i: {{ config.session_timeout or '60' }} ph√∫t</div>
                        <select id="sessionTimeout" name="session_timeout">
                            <option value="30" {{ 'selected' if config.session_timeout == '30' else '' }}>30 ph√∫t</option>
                            <option value="60" {{ 'selected' if config.session_timeout == '60' else '' }}>1 gi·ªù</option>
                            <option value="120" {{ 'selected' if config.session_timeout == '120' else '' }}>2 gi·ªù</option>
                            <option value="480" {{ 'selected' if config.session_timeout == '480' else '' }}>8 gi·ªù</option>
                            <option value="1440" {{ 'selected' if config.session_timeout == '1440' else '' }}>24 gi·ªù</option>
                        </select>
                        <small>Th·ªùi gian t·ª± ƒë·ªông ƒëƒÉng xu·∫•t khi kh√¥ng ho·∫°t ƒë·ªông</small>
                    </div>
                    <div class="form-group">
                        <label for="maxLoginAttempts">S·ªë l·∫ßn ƒëƒÉng nh·∫≠p t·ªëi ƒëa:</label>
                        <div class="current-value">Hi·ªán t·∫°i: {{ config.max_login_attempts or '5' }} l·∫ßn</div>
                        <input type="number" id="maxLoginAttempts" name="max_login_attempts" value="{{ config.max_login_attempts or '5' }}" min="3" max="20">
                        <small>S·ªë l·∫ßn ƒëƒÉng nh·∫≠p sai t·ªëi ƒëa tr∆∞·ªõc khi kh√≥a t√†i kho·∫£n</small>
                    </div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="requireStrongPassword" name="require_strong_password" {{ 'checked' if config.require_strong_password else '' }}>
                            <label for="requireStrongPassword">Y√™u c·∫ßu m·∫≠t kh·∫©u m·∫°nh</label>
                        </div>
                        <small>B·∫Øt bu·ªôc m·∫≠t kh·∫©u c√≥ √≠t nh·∫•t 8 k√Ω t·ª±, ch·ªØ hoa, ch·ªØ th∆∞·ªùng, s·ªë</small>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        üîí L∆∞u c√†i ƒë·∫∑t b·∫£o m·∫≠t
                    </button>
                </form>
            </div>

            <!-- Performance Settings -->
            <div class="settings-section">
                <h3>
                    <span class="icon">‚ö°</span>
                    C√†i ƒë·∫∑t hi·ªáu nƒÉng
                </h3>
                <form id="performanceSettingsForm">
                    <div class="form-group">
                        <label for="maxFileSize">K√≠ch th∆∞·ªõc file t·ªëi ƒëa (MB):</label>
                        <div class="current-value">Hi·ªán t·∫°i: {{ config.max_file_size or '100' }} MB</div>
                        <select id="maxFileSize" name="max_file_size">
                            <option value="50" {{ 'selected' if config.max_file_size == '50' else '' }}>50 MB</option>
                            <option value="100" {{ 'selected' if config.max_file_size == '100' else '' }}>100 MB</option>
                            <option value="500" {{ 'selected' if config.max_file_size == '500' else '' }}>500 MB</option>
                            <option value="1000" {{ 'selected' if config.max_file_size == '1000' else '' }}>1 GB</option>
                            <option value="2000" {{ 'selected' if config.max_file_size == '2000' else '' }}>2 GB</option>
                        </select>
                        <small>K√≠ch th∆∞·ªõc file t·ªëi ƒëa c√≥ th·ªÉ upload</small>
                    </div>
                    <div class="form-group">
                        <label for="cacheTimeout">Cache timeout (gi√¢y):</label>
                        <div class="current-value">Hi·ªán t·∫°i: {{ config.cache_timeout or '300' }} gi√¢y</div>
                        <input type="number" id="cacheTimeout" name="cache_timeout" value="{{ config.cache_timeout or '300' }}" min="60" max="3600">
                        <small>Th·ªùi gian cache d·ªØ li·ªáu</small>
                    </div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="enableCompression" name="enable_compression" {{ 'checked' if config.enable_compression else '' }}>
                            <label for="enableCompression">N√©n d·ªØ li·ªáu</label>
                        </div>
                        <small>B·∫≠t n√©n d·ªØ li·ªáu ƒë·ªÉ ti·∫øt ki·ªám bƒÉng th√¥ng</small>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        ‚ö° L∆∞u c√†i ƒë·∫∑t hi·ªáu nƒÉng
                    </button>
                </form>
            </div>
        </div>

        <!-- Global Actions -->
        <div class="settings-section" style="margin-top: 30px;">
            <h3>
                <span class="icon">üîß</span>
                H√†nh ƒë·ªông to√†n c·ª•c
            </h3>
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <button class="btn btn-success" onclick="saveAllSettings()">
                    üíæ L∆∞u t·∫•t c·∫£ c√†i ƒë·∫∑t
                </button>
                <button class="btn btn-warning" onclick="resetToDefaults()">
                    üîÑ Kh√¥i ph·ª•c m·∫∑c ƒë·ªãnh
                </button>
                <button class="btn btn-secondary" onclick="exportSettings()">
                    üì§ Xu·∫•t c√†i ƒë·∫∑t
                </button>
                <button class="btn btn-secondary" onclick="importSettings()">
                    üì• Nh·∫≠p c√†i ƒë·∫∑t
                </button>
            </div>
        </div>
    </div>

    <script>
        // Handle individual form submissions
        document.getElementById('appSettingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveSettings('app', this);
        });

        document.getElementById('dbSettingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveSettings('database', this);
        });

        document.getElementById('securitySettingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveSettings('security', this);
        });

        document.getElementById('performanceSettingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveSettings('performance', this);
        });

        function saveSettings(category, form) {
            const formData = new FormData(form);
            const settings = Object.fromEntries(formData.entries());
            
            // Convert checkboxes
            const checkboxes = form.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => {
                settings[cb.name] = cb.checked;
            });

            fetch(`/api/admin/settings/${category}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(settings)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(`ƒê√£ l∆∞u c√†i ƒë·∫∑t ${category} th√†nh c√¥ng!`);
                } else {
                    alert('L·ªói: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('C√≥ l·ªói x·∫£y ra khi l∆∞u c√†i ƒë·∫∑t');
            });
        }

        function saveAllSettings() {
            const forms = ['appSettingsForm', 'dbSettingsForm', 'securitySettingsForm', 'performanceSettingsForm'];
            let completed = 0;
            
            forms.forEach(formId => {
                const form = document.getElementById(formId);
                const category = formId.replace('SettingsForm', '').replace('app', 'app').replace('db', 'database');
                
                const formData = new FormData(form);
                const settings = Object.fromEntries(formData.entries());
                
                // Convert checkboxes
                const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(cb => {
                    settings[cb.name] = cb.checked;
                });

                fetch(`/api/admin/settings/${category}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(settings)
                })
                .then(response => response.json())
                .then(data => {
                    completed++;
                    if (completed === forms.length) {
                        alert('ƒê√£ l∆∞u t·∫•t c·∫£ c√†i ƒë·∫∑t th√†nh c√¥ng!');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });
        }

        function resetToDefaults() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën kh√¥i ph·ª•c t·∫•t c·∫£ c√†i ƒë·∫∑t v·ªÅ m·∫∑c ƒë·ªãnh?')) {
                fetch('/api/admin/settings/reset', {
                    method: 'POST'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('ƒê√£ kh√¥i ph·ª•c c√†i ƒë·∫∑t m·∫∑c ƒë·ªãnh th√†nh c√¥ng!');
                        location.reload();
                    } else {
                        alert('L·ªói: ' + data.error);
                    }
                });
            }
        }

        function exportSettings() {
            window.open('/api/admin/settings/export', '_blank');
        }

        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const formData = new FormData();
                    formData.append('settings_file', file);
                    
                    fetch('/api/admin/settings/import', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('ƒê√£ nh·∫≠p c√†i ƒë·∫∑t th√†nh c√¥ng!');
                            location.reload();
                        } else {
                            alert('L·ªói: ' + data.error);
                        }
                    });
                }
            };
            input.click();
        }
    </script>
</body>
</html>
