<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeleDrive - Đăng nhập Telegram</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        .fullscreen-iframe {
            width: 100%;
            height: 100%;
            border: none;
            position: absolute;
        }
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 10px;
            background-color: rgba(33, 37, 41, 0.8);
            color: white;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .btn-close-white {
            background-color: transparent;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.5rem;
        }
    </style>
</head>
<body>
    <div class="overlay">
        <div>
            <h4>TeleDrive - Đăng nhập Telegram</h4>
            <p>Vui lòng đăng nhập vào tài khoản Telegram của bạn. Sau khi đăng nhập thành công, đóng tab này và quay lại ứng dụng TeleDrive.</p>
        </div>
        <button id="closeBtn" class="btn-close-white" onclick="closeLoginWindow()">
            <i class="bi bi-x-lg"></i>
        </button>
    </div>

    <iframe src="https://web.telegram.org/" class="fullscreen-iframe" id="telegramFrame"></iframe>

    <script>
        // Kiểm tra xem người dùng đã đăng nhập Telegram Web chưa
        function checkTelegramLogin() {
            try {
                const frame = document.getElementById('telegramFrame');
                // Kiểm tra trạng thái đăng nhập bằng cách tìm phần tử trong Telegram Web
                const isLoggedIn = frame.contentWindow.document.querySelector('.im_dialogs_col') !== null;
                
                if (isLoggedIn) {
                    // Thông báo đăng nhập thành công
                    alert('Đăng nhập Telegram thành công! Bạn có thể đóng tab này và quay lại TeleDrive.');
                    
                    // Gửi thông báo đến cửa sổ cha (TeleDrive)
                    if (window.opener) {
                        window.opener.postMessage({ type: 'telegram_login_success' }, '*');
                    }
                }
            } catch (e) {
                // Lỗi truy cập iframe do same-origin policy
                console.log('Không thể kiểm tra trạng thái đăng nhập do chính sách bảo mật');
            }
        }

        // Đóng cửa sổ đăng nhập
        function closeLoginWindow() {
            if (window.opener) {
                window.close();
            } else {
                window.location.href = '/';
            }
        }

        // Chạy kiểm tra đăng nhập mỗi 2 giây
        setInterval(checkTelegramLogin, 2000);
    </script>
</body>
</html> 